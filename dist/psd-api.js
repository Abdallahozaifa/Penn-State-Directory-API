(function(){var t=require("request"),e=require("querystring"),r=require("cheerio"),n={},a={},i=function(n,i){a.Student={},a.form={},a.directoryPage={},a.directoryPage.desc=[],a.directoryPage.data=[],a.selectors={TABLES:"body > div > form > table",MATCHES:"b",DESC:"th",DATA:"td"},a.newQuery=function(t,e,r,n){return{cn:t,sn:e,uid:r,mail:n}},a.validate={options:function(t){return/^[a-zA-Z]+$/.test(t)},email:function(t){return t.endsWith("@psu.edu")},userID:function(t){var e,r=t.match(/\d+/g);return e=null!=r},isobjectValid:function(){for(var t=Object.keys(n),e=0;e<t.length;e++)if("firstName"===t[0]&&"lastName"===t[1]){if("string"!=typeof t[0]&&"string"!=typeof t[1])throw new Error("Please provide the correct format for first and last name!")}else{if("firstName"===t[0]&&"lastName"!=t[1])throw new Error("Please provide a last name!");if("userID"===t[e])return!!a.validate.userID(n.userID);if("email"!==t[e])throw new Error("Invalid Object format!");if(a.validate.email(n.email)===!1)throw new Error("Invalid Object format!")}return!0}},a.fillStudentObj=function(t,e,r,n){a.Student.firstName=t,a.Student.lastName=e,a.Student.userID=r,a.Student.email=n},a.initStrStudent=function(){if(a.validate.email(n))a.fillStudentObj("","","",n);else if(a.validate.userID(n))a.fillStudentObj("","",n,"");else{var t=n.split(" ");if(2!==t.length)return void console.error("Please enter a first and last name!");a.fillStudentObj(t[0],t[1])}},a.initStudent=function(){"object"==typeof n?a.validate.isobjectValid()&&Object.assign(a.Student,n):"string"==typeof n&&a.initStrStudent()}(),a.form.data=a.newQuery(a.Student.firstName,a.Student.lastName,a.Student.userID,a.Student.email),a.form.stringFormData=e.stringify(a.form.data),a.form.contentLength=a.form.stringFormData.length,a.form.dirLink="http://www.work.psu.edu/cgi-bin/ldap/ldap_query.cgi",a.form.reqOptions={headers:{"Content-Length":a.form.contentLength,"Content-Type":"application/x-www-form-urlencoded"},url:a.form.dirLink,body:a.form.stringFormData,method:"POST"},a.removeLinBr=function(t){for(var e in t)t[e]=t[e].trim(),t[e]=t[e].replace(/:/g,""),a.validate.email(t[e])&&(t[e]=t[e].replace(/\n+/g,", "))},a.isStudentFound=function(t){return 0!=t(a.selectors.MATCHES).text().indexOf("0 matches",0)&&""!==n},a.formatData=function(){a.directoryPage.desc.shift(),a.removeLinBr(a.directoryPage.desc),a.removeLinBr(a.directoryPage.data)},a.extractData=function(t){a.directoryPage.data=[],a.directoryPage.desc=[],a.forms=[];var e=t(a.selectors.TABLES);a.studs=[],e.each(function(e){var r=t(this).text();a.studs.push(r)}),t(a.selectors.DESC).each(function(){a.directoryPage.desc.push(t(this).text())}),t(a.selectors.DATA).each(function(){a.directoryPage.data.push(t(this).text())})},a.initStudentData=function(){a.Student={};for(var t in a.directoryPage.data){var e=a.directoryPage.desc[t];a.Student[e]=a.directoryPage.data[t]}},a.getStudentInfo=function(t){a.extractData(t),a.formatData(),a.initStudentData()},a.findStudent=function(t){var e=r.load(t);a.isStudentFound(e)?a.getStudentInfo(e):""!=n?a.Student=null:console.error("Please enter a student!")},a.scrape=function(t){a.findStudent(t)};var o=function(t,e,r){if(t)throw new Error("Error in retrieving student informaton");a.scrape(e.body),i(a.Student)};t(a.form.reqOptions,o)};n.get=function(t,e){if(2!=arguments.length||"function"!=typeof e)return void console.error("Please provide the correct number of parameters and a callback function!");if(Array.isArray(t))for(var r in t)i(t[r],e);else i(t,e)},module.exports=n}).call(this);
